{
  "facts": [
    {
      "id": "emp_123",
      "data": {
        "entity_type": "employee",
        "employee_id": "emp_123",
        "has_student_visa": true,
        "weekly_hour_limit": 20.0
      }
    },
    {
      "id": "shift_001",
      "data": {
        "entity_type": "shift",
        "employee_id": "emp_123",
        "start_time": "2024-06-17T09:00:00Z",
        "end_time": "2024-06-17T17:00:00Z"
      }
    },
    {
      "id": "shift_002",
      "data": {
        "entity_type": "shift",
        "employee_id": "emp_123",
        "start_time": "2024-06-18T10:00:00Z",
        "end_time": "2024-06-18T18:00:00Z"
      }
    },
    {
      "id": "shift_003",
      "data": {
        "entity_type": "shift",
        "employee_id": "emp_123",
        "start_time": "2024-06-19T09:00:00Z",
        "end_time": "2024-06-19T17:30:00Z"
      }
    }
  ],
  "rules": [
    {
      "id": "calculate-shift-hours",
      "priority": 200,
      "conditions": [
        {
          "field": "entity_type",
          "operator": "equal",
          "value": "shift"
        }
      ],
      "actions": [
        {
          "type": "call_calculator",
          "calculator_name": "hours_between_datetime",
          "input_mapping": {
            "start_time": "start_time",
            "end_time": "end_time"
          },
          "output_field": "calculated_hours"
        }
      ]
    },
    {
      "id": "check-student-visa-hours",
      "priority": 100,
      "conditions": [
        {
          "field": "entity_type",
          "operator": "equal",
          "value": "employee"
        },
        {
          "field": "has_student_visa",
          "operator": "equal",
          "value": true
        }
      ],
      "actions": [
        {
          "type": "call_calculator",
          "calculator_name": "threshold_checker",
          "input_mapping": {
            "value": {
              "source_type": "aggregate",
              "source_field": "calculated_hours",
              "filter": "entity_type == 'shift' && employee_id == current_fact.employee_id"
            },
            "threshold": "weekly_hour_limit",
            "operator": "GreaterThan"
          },
          "output_field": "compliance_check"
        },
        {
          "type": "create_fact",
          "condition": "{{compliance_check.passes}}",
          "fact_id": "violation_{{current_fact.employee_id}}",
          "fact_data": {
            "entity_type": "compliance_violation",
            "employee_id": "{{current_fact.employee_id}}",
            "violation_type": "weekly_hour_limit",
            "violation_amount": "{{compliance_check.violation_amount}}",
            "total_hours": "{{compliance_check.value}}"
          }
        }
      ]
    }
  ]
}